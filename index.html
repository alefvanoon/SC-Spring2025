<style>
/* Dark mode styles */
body.dark {
    background-color: #1e293b; /* slate-800 */
    color: #f8fafc; /* slate-50 */
}

body.dark .bg-white {
    background-color: #334155; /* slate-700 */
}

body.dark .hover\:bg-slate-50:hover {
    background-color: #475569; /* slate-600 */
}

body.dark .text-slate-700 {
    color: #cbd5e1; /* slate-300 */
}

body.dark .border-slate-300 {
    border-color: #475569; /* slate-600 */
}

body.dark .shadow-sm {
    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.5);
}

body.dark .hover\:shadow-md:hover {
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.7), 0 2px 4px -1px rgba(0, 0, 0, 0.6);
}

body.dark .bg-slate-50 {
    background-color: #273444; /* A dark slate, like slate-800 but distinct for inner elements */
}

body.dark .border-slate-200 {
    border-color: #3f4d5a; /* A darker slate border */
}

body.dark .shadow-inner {
    box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.5);
}

body.dark .text-slate-600 {
    color: #a3b1c2; /* Lighter slate for text */
}

body.dark .bg-sky-50 {
    background-color: #0c4a6e; /* Darker sky */
    color: #e0f2fe; /* sky-200 for text */
}

body.dark .border-sky-200 {
    border-color: #075985; /* Darker sky border */
}

body.dark .text-sky-700 {
    color: #bae6fd; /* sky-300 */
}

body.dark .bg-rose-50 {
    background-color: #570a1c; /* Darker rose */
    color: #ffe4e6; /* rose-100 for text */
}

body.dark .border-rose-200 {
    border-color: #881337; /* Darker rose border */
}

body.dark .text-rose-700 {
    color: #ffcdd2; /* rose-200 */
}

body.dark .bg-blue-500 {
    background-color: #1d4ed8; /* blue-700 */
}

body.dark .hover\:bg-blue-600:hover {
    background-color: #1e40af; /* blue-800 */
}

body.dark .bg-green-500 {
    background-color: #16a34a; /* green-700 */
}

body.dark .hover\:bg-green-600:hover {
    background-color: #15803d; /* green-800 */
}

body.dark .bg-red-500 {
    background-color: #dc2626; /* red-700 */
}

body.dark .hover\:bg-red-600:hover {
    background-color: #b91c1c; /* red-800 */
}

body.dark .bg-purple-500 {
    background-color: #7c3aed; /* purple-700 */
}

body.dark .hover\:bg-purple-600:hover {
    background-color: #6d28d9; /* purple-800 */
}

body.dark .text-blue-600 {
    color: #60a5fa; /* blue-300 */
}

body.dark .text-red-700 { 
    color: #f87171; /* red-400, for error messages */
}
body.dark .bg-red-100 { /* Error message background */
    background-color: #450a0a; /* Dark red background */
}
body.dark .border-red-500 { /* Error message border */
    border-color: #ef4444; /* red-500 */
}


body.dark .text-green-500 {
    color: #86efac; /* green-300 */
}

body.dark .text-purple-500 {
    color: #d8b4fe; /* purple-300 */
}

body.dark .bg-gradient-to-r { /* Header gradient */
    background-image: linear-gradient(to right, #0f172a, #17253e); 
}

body.dark .github-link {
    background-color: #374151; /* slate-700 */
}

body.dark .github-link:hover {
    background-color: #4b5563; /* slate-600 */
}

body.dark .main-loader-spinner {
    border-left-color: #60a5fa; /* blue-300 */
    border-color: #475569; /* slate-600 for other borders */
}

body.dark #pyodide-loader-message .text-slate-200 {
    color: #cbd5e1; /* slate-300 */
}

body.dark .tab-btn {
    background-color: #475569; /* slate-600 */
    color: #e2e8f0; /* slate-200 */
    border-color: #525f71; 
}
body.dark .tab-btn:hover {
    background-color: #525f71; 
}
body.dark .tab-btn.active {
    background-color: #2563eb; /* blue-600 */
    color: white;
    border-color: #1d4ed8; /* blue-700 */
}

body.dark .bg-slate-100 { /* Used for result section background */
    background-color: #1e293b; /* slate-800 */
}
body.dark .text-slate-800 { /* Used for card titles, etc. */
    color: #f1f5f9; /* slate-100 */
}
body.dark .border-b.border-slate-200 { /* Card title border bottom */
    border-bottom-color: #475569; /* slate-600 */
}
body.dark .bg-slate-800 { /* Footer background */
    background-color: #0f172a; /* slate-900 */
}
body.dark .text-slate-300 { /* Footer text */
    color: #94a3b8; /* slate-400 */
}
body.dark .text-teal-400 {
    color: #2dd4bf; 
}
body.dark .bg-teal-500 {
    background-color: #0d9488; /* teal-600 */
}
body.dark .text-sky-600 { /* About project icon */
    color: #38bdf8; /* sky-400 */
}
body.dark .text-yellow-500 { /* Example icon */
    color: #facc15; /* yellow-400 */
}

/* Ensure matrix input text is visible in dark mode */
body.dark .matrix-cell {
    color: #e2e8f0; /* slate-200, light gray for text */
    background-color: #1e293b; /* slate-800, a dark background for input */
    border-color: #475569; /* slate-600 for border */
}

/* Ensure matrix output text is visible in dark mode */
body.dark .matrix-output {
    color: #f1f5f9; /* slate-100, very light gray for text */
    background-color: #273444; /* A distinct dark background for output, e.g. slate-800/700 mix */
}

/* Ensure Rows/Cols/Size input text is visible in dark mode */
body.dark #ref-rows, 
body.dark #ref-cols, 
body.dark #det-size {
    color: #e2e8f0; /* slate-200 */
    background-color: #1e293b; /* slate-800 */
    border-color: #475569; /* slate-600 */
}
/* Add a placeholder color for dark mode if needed */
body.dark input::placeholder {
    color: #94a3b8; /* slate-400 */
}


</style>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Linear Algebra Tools | Scientific Computing Project</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease; /* Smooth theme transition */
        }
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e2e8f0; /* slate-200 */
        }
        body.dark ::-webkit-scrollbar-track {
            background: #334155; /* slate-700 */
        }
        ::-webkit-scrollbar-thumb {
            background: #94a3b8; /* slate-400 */
            border-radius: 10px;
        }
        body.dark ::-webkit-scrollbar-thumb {
            background: #64748b; /* slate-500 */
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; /* slate-500 */
        }
        body.dark ::-webkit-scrollbar-thumb:hover {
            background: #475569; /* slate-600 */
        }
        .matrix-cell {
            transition: all 0.2s ease-in-out;
        }
        .matrix-cell:focus {
            outline: 2px solid #3b82f6; /* blue-500 */
            border-color: transparent;
            transform: scale(1.05);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        body.dark .matrix-cell:focus {
            outline-color: #60a5fa; /* blue-400 for dark mode */
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.25);
        }
        .tab-btn.active {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .card {
            display: none; /* Initially hide cards */
        }
        .card.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .main-loader-spinner { /* For the initial Pyodide loader */
             border-left-color: #3b82f6; /* blue-500 */
        }
         /* Ensure all elements transition smoothly */
        * {
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease; /* Slightly faster transition */
        }
    </style>
</head>
<body class="antialiased text-slate-800 bg-slate-100">
    <div class="min-h-screen flex flex-col">
        <header class="bg-gradient-to-r from-slate-800 to-slate-900 text-white shadow-lg">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-5">
                <div class="flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <i class="fa-solid fa-calculator text-3xl text-teal-400"></i>
                        <h1 class="text-2xl sm:text-3xl font-bold">Linear Algebra Tools</h1>
                    </div>
                    <div class="flex items-center gap-4">
                        <button id="theme-toggle" title="Toggle theme" class="rounded-full p-2 text-slate-400 hover:text-slate-200 focus:outline-none focus:ring-2 focus:ring-slate-500 transition-colors duration-300">
                            <i id="theme-toggle-dark-icon" class="fas fa-moon hidden"></i>
                            <i id="theme-toggle-light-icon" class="fas fa-sun"></i>
                        </button>
                        <div class="text-sm bg-teal-500 px-3 py-1 rounded-full shadow">
                            <i class="fa-solid fa-flask mr-1"></i> Scientific Computing Project
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="flex flex-wrap justify-center mb-8 gap-2 sm:gap-3">
                <button class="tab-btn active text-sm sm:text-base bg-white hover:bg-slate-50 text-slate-700 font-semibold py-2.5 px-5 rounded-lg transition-all duration-200 shadow-sm border border-slate-300" data-tab="ref">
                    <i class="fa-solid fa-table-columns mr-2 opacity-80"></i>Row Echelon Form
                </button>
                <button class="tab-btn text-sm sm:text-base bg-white hover:bg-slate-50 text-slate-700 font-semibold py-2.5 px-5 rounded-lg transition-all duration-200 shadow-sm border border-slate-300" data-tab="det">
                    <i class="fa-solid fa-equals mr-2 opacity-80"></i>Determinant
                </button>
            </div>

            <div class="card active bg-white p-6 sm:p-8 rounded-xl shadow-xl mb-8" id="ref-card">
                <h2 class="text-xl sm:text-2xl font-semibold text-slate-800 mb-6 pb-4 border-b border-slate-200 flex items-center gap-3">
                    <i class="fa-solid fa-diagram-project text-blue-600"></i>Row Echelon Form Calculator
                </h2>
                
                <div class="grid md:grid-cols-2 gap-6 sm:gap-8">
                    <div class="matrix-input-area bg-slate-50 p-5 sm:p-6 rounded-lg border border-slate-200 shadow-sm">
                        <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2"><i class="fa-solid fa-border-all text-blue-500"></i>Enter Matrix Dimensions</h3>
                        <div class="flex flex-col sm:flex-row sm:flex-wrap items-start sm:items-center gap-x-4 gap-y-3 mb-5">
                            <label class="flex items-center gap-2 text-sm font-medium text-slate-600">
                                Rows: 
                                <input type="number" id="ref-rows" min="1" max="6" value="3" class="w-20 p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition shadow-sm">
                            </label>
                            <label class="flex items-center gap-2 text-sm font-medium text-slate-600">
                                Columns: 
                                <input type="number" id="ref-cols" min="1" max="6" value="3" class="w-20 p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition shadow-sm">
                            </label>
                            <button class="btn bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-md transition shadow hover:shadow-md flex items-center gap-2 text-sm w-full sm:w-auto justify-center sm:ml-auto mt-2 sm:mt-0" id="ref-generate-btn"> <i class="fa-solid fa-arrows-rotate"></i>Generate Matrix
                            </button>
                        </div>
                        
                        <div class="error bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-md text-sm mb-4 hidden shadow" id="ref-error" role="alert"></div>
                        
                        <div class="matrix-grid mb-5 space-y-2 overflow-x-auto" id="ref-matrix-container">
                            </div>
                        
                        <button class="btn bg-green-500 hover:bg-green-600 text-white font-bold py-2.5 px-6 rounded-md transition shadow-md hover:shadow-lg flex items-center gap-2 w-full sm:w-auto justify-center text-base" id="ref-calculate-btn">
                            <i class="fa-solid fa-gears"></i>Calculate REF
                        </button>
                    </div>
                    
                    <aside class="info-area bg-sky-50 p-5 sm:p-6 rounded-lg border border-sky-200 text-slate-600 shadow-sm">
                        <h3 class="text-lg font-semibold text-sky-700 mb-3 flex items-center gap-2"><i class="fa-solid fa-circle-info"></i>About Row Echelon Form</h3>
                        <p class="text-sm mb-3">Row Echelon Form (REF) is achieved when a matrix satisfies:</p>
                        <ul class="list-disc list-inside text-sm space-y-1.5 mb-4 pl-2">
                            <li>All non-zero rows are above any rows of all zeros.</li>
                            <li>The leading coefficient (pivot) of a non-zero row is always strictly to the right of the pivot of the row above it.</li>
                            <li>All entries in a column below a leading coefficient are zero.</li>
                            <li>(Optional, for RREF) Each pivot is 1 and is the only non-zero entry in its column. This calculator aims for RREF.</li>
                        </ul>
                        <p class="text-sm mb-4">This tool uses Gaussian elimination to transform the input matrix.</p>
                        <div class="bg-white p-4 rounded-md border border-slate-200 shadow-inner">
                            <h4 class="text-sm font-semibold text-slate-700 mb-2 flex items-center gap-1.5"><i class="fa-solid fa-lightbulb text-yellow-500"></i>Example Matrix:</h4>
                            <pre class="bg-slate-100 p-3 rounded text-sm overflow-x-auto font-mono">1  2  3&#10;4  5  6&#10;7  8  9</pre>
                            <p class="text-xs text-slate-500 mt-2">Input this matrix to observe its REF transformation.</p>
                        </div>
                    </aside>
                </div>
                
                <div class="result-section mt-6 p-6 bg-slate-100 rounded-lg border border-slate-200 shadow-inner hidden" id="ref-result">
                    <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2"><i class="fa-solid fa-clipboard-check text-green-500"></i>Result: Row Echelon Form</h3>
                    <div class="matrix-output bg-white p-4 rounded-md border border-slate-300 shadow text-sm sm:text-base overflow-x-auto whitespace-pre font-mono" id="ref-output"></div>
                </div>
            </div>

            <div class="card bg-white p-6 sm:p-8 rounded-xl shadow-xl mb-8" id="det-card">
                <h2 class="text-xl sm:text-2xl font-semibold text-slate-800 mb-6 pb-4 border-b border-slate-200 flex items-center gap-3">
                    <i class="fa-solid fa-calculator-alt text-red-600"></i>Determinant Calculator </h2>
                
                <div class="grid md:grid-cols-2 gap-6 sm:gap-8">
                    <div class="matrix-input-area bg-slate-50 p-5 sm:p-6 rounded-lg border border-slate-200 shadow-sm">
                        <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2"><i class="fa-solid fa-table text-red-500"></i>Enter Square Matrix Size</h3>
                        <div class="flex flex-col sm:flex-row sm:flex-wrap items-start sm:items-center gap-x-4 gap-y-3 mb-5">
                            <label class="flex items-center gap-2 text-sm font-medium text-slate-600">
                                Size (NxN): 
                                <input type="number" id="det-size" min="1" max="6" value="3" class="w-20 p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-red-500 focus:border-red-500 transition shadow-sm">
                            </label>
                            <button class="btn bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-md transition shadow hover:shadow-md flex items-center gap-2 text-sm w-full sm:w-auto justify-center sm:ml-auto mt-2 sm:mt-0" id="det-generate-btn"> <i class="fa-solid fa-arrows-rotate"></i>Generate Matrix
                            </button>
                        </div>
                        
                        <div class="error bg-red-100 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-md text-sm mb-4 hidden shadow" id="det-error" role="alert"></div>
                        
                        <div class="matrix-grid mb-5 space-y-2 overflow-x-auto" id="det-matrix-container">
                            </div>
                        
                        <button class="btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-2.5 px-6 rounded-md transition shadow-md hover:shadow-lg flex items-center gap-2 w-full sm:w-auto justify-center text-base" id="det-calculate-btn">
                            <i class="fa-solid fa-calculator"></i>Calculate Determinant
                        </button>
                    </div>
                    
                    <aside class="info-area bg-rose-50 p-5 sm:p-6 rounded-lg border border-rose-200 text-slate-600 shadow-sm">
                        <h3 class="text-lg font-semibold text-rose-700 mb-3 flex items-center gap-2"><i class="fa-solid fa-circle-info"></i>About Matrix Determinant</h3>
                        <p class="text-sm mb-3">The determinant is a unique scalar value associated with a square matrix. Key properties include:</p>
                        <ul class="list-disc list-inside text-sm space-y-1.5 mb-4 pl-2">
                            <li>Indicates if a matrix is invertible (non-zero determinant) or singular (zero determinant).</li>
                            <li>Represents the scaling factor of the linear transformation described by the matrix (e.g., area for 2x2, volume for 3x3).</li>
                            <li>Can be computed through various methods, including cofactor expansion or using properties of row operations.</li>
                        </ul>
                        <p class="text-sm mb-4">This tool utilizes NumPy for accurate and efficient determinant computation.</p>
                         <div class="bg-white p-4 rounded-md border border-slate-200 shadow-inner">
                            <h4 class="text-sm font-semibold text-slate-700 mb-2 flex items-center gap-1.5"><i class="fa-solid fa-lightbulb text-yellow-500"></i>Example Matrix:</h4>
                            <pre class="bg-slate-100 p-3 rounded text-sm overflow-x-auto font-mono">1  2  3&#10;4  5  6&#10;7  8  9</pre>
                            <p class="text-xs text-slate-500 mt-2">This matrix has a determinant of 0 (it's singular).</p>
                        </div>
                    </aside>
                </div>
                
                <div class="result-section mt-6 p-6 bg-slate-100 rounded-lg border border-slate-200 shadow-inner hidden" id="det-result">
                    <h3 class="text-lg font-semibold text-slate-700 mb-4 flex items-center gap-2"><i class="fa-solid fa-check-double text-purple-500"></i>Determinant Result</h3>
                    <div class="matrix-output bg-white p-4 rounded-md border border-slate-300 shadow text-lg font-semibold overflow-x-auto whitespace-pre font-mono" id="det-output"></div>
                </div>
            </div>

            <div class="main-loader fixed inset-0 bg-slate-900 bg-opacity-90 flex flex-col items-center justify-center z-50" id="pyodide-loader">
                <div class="main-loader-spinner border-4 border-slate-400 rounded-full w-16 h-16 animate-spin mb-6"></div>
                <div id="pyodide-loader-message" class="text-slate-200 text-center">
                    <p class="text-xl font-semibold">Initializing Linear Algebra Engine...</p>
                    <p class="text-sm mt-1">Please wait, this may take a moment.</p>
                </div>
            </div>
            
            <section class="about-project-section bg-white p-6 sm:p-8 rounded-xl shadow-xl mt-12">
                <h3 class="text-xl sm:text-2xl font-semibold text-slate-800 mb-4 flex items-center gap-3"><i class="fa-solid fa-book-open text-teal-600"></i>About This Project</h3>
                <div class="text-slate-600 text-sm sm:text-base leading-relaxed space-y-3">
                    <p>This interactive web application serves as a practical tool for understanding fundamental linear algebra concepts. Developed as a part of a Scientific Computing course, it leverages the power of WebAssembly to perform matrix calculations directly in your browser.</p>
                    <p>The application features robust calculators for Row Echelon Form (REF/RREF) via Gaussian elimination and matrix determinants using NumPy, all powered by Pyodide, which brings Python and its scientific libraries to the web environment.</p>
                    <p>No server-side processing is required for the core calculations, ensuring privacy and speed.</p>
                </div>
                <div class="mt-6 text-center">
                    <a href="https://github.com/alefvanoon/SC-Spring2025" class="github-link inline-flex items-center gap-2.5 bg-slate-800 hover:bg-slate-700 text-white font-semibold py-2.5 px-6 rounded-lg transition-all duration-300 shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-slate-500 focus:ring-opacity-50" target="_blank" rel="noopener noreferrer">
                        <i class="fab fa-github text-lg"></i>View Project on GitHub
                    </a>
                </div>
            </section>
        </main>
            
        <footer class="bg-slate-800 text-slate-300 py-8 shadow-inner-top mt-auto">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
                <p class="text-sm mb-1">&copy; 2025 Linear Algebra Tools - Scientific Computing Course Project.</p>
                <p class="text-xs">Developed with Pyodide, NumPy, and Tailwind CSS.</p>
            </div>
        </footer>
    </div>

    <script>
        let pyodide;
        let pyodideReady = false;
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        
        const pyodideLoader = document.getElementById('pyodide-loader');
        const pyodideLoaderMessage = document.getElementById('pyodide-loader-message');

        function updatePyodideLoaderMessage(mainText, subText = "") {
            if (pyodideLoaderMessage) {
                pyodideLoaderMessage.innerHTML = `
                    <p class="text-xl font-semibold">${mainText}</p>
                    ${subText ? `<p class="text-sm mt-1">${subText}</p>` : ''}
                `;
            }
        }
        
        // Function to apply theme
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark');
                if(themeToggleDarkIcon) themeToggleDarkIcon.classList.remove('hidden');
                if(themeToggleLightIcon) themeToggleLightIcon.classList.add('hidden');
            } else {
                document.body.classList.remove('dark');
                if(themeToggleDarkIcon) themeToggleDarkIcon.classList.add('hidden');
                if(themeToggleLightIcon) themeToggleLightIcon.classList.remove('hidden');
            }
        }

        function toggleTheme() {
            const newTheme = document.body.classList.contains('dark') ? 'light' : 'dark';
            applyTheme(newTheme);
            localStorage.setItem('theme', newTheme);
        }
        
        // Event listener for theme toggle button
        if (themeToggleBtn) { 
            themeToggleBtn.addEventListener('click', toggleTheme);
        }


        async function initializePyodide() {
            if(pyodideLoader) pyodideLoader.style.display = 'flex'; 
            try {
                updatePyodideLoaderMessage("Loading Python runtime...", "Download: ~7MB. This can take a moment.");
                pyodide = await loadPyodide({ indexURL: "https://cdn.jsdelivr.net/pyodide/v0.25.1/full/" });
                
                updatePyodideLoaderMessage("Loading NumPy library...");
                await pyodide.loadPackage("numpy");
                
                updatePyodideLoaderMessage("Preparing linear algebra functions...");
                await pyodide.runPython(`
import numpy as np
def get_row_echelon_form(matrix_list):
    mat = np.array(matrix_list, dtype=float)
    rows, cols = mat.shape
    pivot_row, lead_col = 0, 0
    tolerance = 1e-9 

    while pivot_row < rows and lead_col < cols:
        i = pivot_row
        while i < rows and abs(mat[i, lead_col]) < tolerance:
            i += 1
        
        if i < rows: 
            mat[[pivot_row, i]] = mat[[i, pivot_row]]
            
            pivot_val = mat[pivot_row, lead_col]
            if abs(pivot_val) > tolerance: 
                 mat[pivot_row] = mat[pivot_row] / pivot_val
            
            for j in range(rows):
                if j != pivot_row: 
                    factor = mat[j, lead_col] 
                    mat[j] = mat[j] - factor * mat[pivot_row]
            pivot_row += 1
        lead_col += 1
        
    mat[np.abs(mat) < tolerance] = 0.0
    return mat.tolist()
                `);
                pyodideReady = true;
                if(pyodideLoader) pyodideLoader.style.display = 'none'; 
                console.log("Pyodide and NumPy initialized successfully!");
                enableUI();
                generateMatrix('ref-matrix-container', 3, 3, [[1, 2, 3], [4, 5, 6], [7, 8, 9]]);
                generateMatrix('det-matrix-container', 3, 3, [[1, 2, 3], [4, 5, 6], [7, 8, 9]]);
            } catch (error) {
                console.error("Error initializing Pyodide:", error);
                updatePyodideLoaderMessage(`<span class="text-red-400">Initialization Failed: ${error.message}</span>`, "Please check your internet connection or browser console and refresh the page.");
            }
        }

        function enableUI() {
            ['ref-generate-btn', 'det-generate-btn', 'ref-calculate-btn', 'det-calculate-btn'].forEach(id => {
                const btn = document.getElementById(id);
                if (btn) btn.disabled = false;
            });
        }

        function showError(sectionPrefix, message) {
            const errorEl = document.getElementById(`${sectionPrefix}-error`);
            if (errorEl) {
                errorEl.innerHTML = `<strong class="font-semibold">Error:</strong> ${message}`; 
                errorEl.style.display = 'block';
                setTimeout(() => { errorEl.style.display = 'none'; }, 7000);
            }
        }

        function generateMatrix(containerId, rows, cols, initialValues = null) {
            const container = document.getElementById(containerId);
            if (!container) { console.error("Matrix container not found:", containerId); return; }
            container.innerHTML = ''; 
            
            for (let i = 0; i < rows; i++) {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'matrix-row flex justify-center gap-2 mb-2'; 
                for (let j = 0; j < cols; j++) {
                    const input = document.createElement('input');
                    input.type = 'text'; 
                    input.className = 'matrix-cell w-14 h-10 sm:w-16 sm:h-12 text-center border border-slate-300 rounded-md text-sm sm:text-base focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition shadow-sm';
                    if (initialValues && initialValues[i] && typeof initialValues[i][j] !== 'undefined') {
                        input.value = initialValues[i][j];
                    } else {
                        input.value = (i === j && rows === cols) ? '1' : '0'; 
                    }
                    input.dataset.row = i;
                    input.dataset.col = j;
                    rowDiv.appendChild(input);
                }
                container.appendChild(rowDiv);
            }
        }

        function getMatrixValues(containerId, sectionPrefix) {
            const container = document.getElementById(containerId);
            if (!container) { console.error("Matrix container for values not found:", containerId); return null; }

            const inputs = container.querySelectorAll('.matrix-cell');
            if (inputs.length === 0) {
                showError(sectionPrefix, "No matrix generated or inputs found.");
                return null;
            }

            const matrix = [];
            let maxRow = -1, maxCol = -1;
            inputs.forEach(input => {
                maxRow = Math.max(maxRow, parseInt(input.dataset.row));
                maxCol = Math.max(maxCol, parseInt(input.dataset.col));
            });

            const numRows = maxRow + 1;
            const numCols = maxCol + 1;

            for (let i = 0; i < numRows; i++) {
                matrix[i] = new Array(numCols).fill(0); 
            }
            
            let allValid = true;
            inputs.forEach(input => {
                const r = parseInt(input.dataset.row);
                const c = parseInt(input.dataset.col);
                let valStr = input.value.trim();
                
                if (valStr === '') { 
                    valStr = '0'; 
                    input.value = '0'; 
                }
                
                if (!/^-?\d*\.?\d+$/.test(valStr) && valStr !== '0') { 
                     if (isNaN(parseFloat(valStr))) { 
                        showError(sectionPrefix, `Invalid number "${input.value}" at row ${r + 1}, column ${c + 1}. Please use valid numbers.`);
                        input.classList.add('border-red-500', 'ring-red-500'); 
                        allValid = false;
                        return; 
                    }
                }
                input.classList.remove('border-red-500', 'ring-red-500'); 
                if(allValid) matrix[r][c] = parseFloat(valStr);
            });

            if (!allValid) return null; 
            return matrix;
        }

        function formatMatrixForDisplay(matrixArray) {
            if (!matrixArray || !Array.isArray(matrixArray)) return "Error: Invalid matrix format for display.";
            return matrixArray.map(row => 
                row.map(val => {
                    if (typeof val !== 'number') return String(val); 
                    if (Math.abs(val) < 1e-9) return '0'; 
                    let s = parseFloat(val.toFixed(4)).toString();
                    return s;
                }).join('\t\t') 
            ).join('\n');
        }
        
        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                
                const tab = button.dataset.tab;
                document.querySelectorAll('.card').forEach(card => card.classList.remove('active'));
                const activeCard = document.getElementById(`${tab}-card`);
                if (activeCard) activeCard.classList.add('active');
            });
        });

        document.addEventListener('DOMContentLoaded', () => {
            const storedTheme = localStorage.getItem('theme');
            if (storedTheme) {
                applyTheme(storedTheme);
            } else { 
                applyTheme('light'); // Default to light theme
            }
            
            initializePyodide();
            
            ['ref-calculate-btn', 'det-calculate-btn'].forEach(id => {
                 const btn = document.getElementById(id);
                 if (btn) btn.disabled = true;
            });
            document.getElementById('ref-generate-btn').disabled = false;
            document.getElementById('det-generate-btn').disabled = false;

            document.getElementById('ref-generate-btn').addEventListener('click', () => {
                const rows = parseInt(document.getElementById('ref-rows').value) || 3;
                const cols = parseInt(document.getElementById('ref-cols').value) || 3;
                generateMatrix('ref-matrix-container', rows, cols);
                document.getElementById('ref-result').classList.add('hidden'); 
                document.getElementById('ref-error').style.display = 'none'; 
            });
            
            document.getElementById('det-generate-btn').addEventListener('click', () => {
                const size = parseInt(document.getElementById('det-size').value) || 3;
                generateMatrix('det-matrix-container', size, size);
                document.getElementById('det-result').classList.add('hidden'); 
                document.getElementById('det-error').style.display = 'none'; 
            });
            
            document.getElementById('ref-calculate-btn').addEventListener('click', async () => {
                if (!pyodideReady) { showError('ref', "Python engine is still initializing. Please wait a moment."); return; }
                
                const matrix = getMatrixValues('ref-matrix-container', 'ref');
                if (!matrix) return; 

                const calcButton = document.getElementById('ref-calculate-btn');
                calcButton.disabled = true;
                calcButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Calculating...';
                
                try {
                    const refMatrixPy = pyodide.globals.get('get_row_echelon_form')(matrix);
                    const refMatrixJS = refMatrixPy.toJs({depth: 2}); 
                    refMatrixPy.destroy(); 

                    document.getElementById('ref-output').textContent = formatMatrixForDisplay(refMatrixJS);
                    document.getElementById('ref-result').classList.remove('hidden');
                    document.getElementById('ref-error').style.display = 'none'; 
                } catch (error) {
                    console.error("Error calculating REF:", error);
                    showError('ref', "Calculation error: " + error.message);
                } finally {
                    calcButton.disabled = false;
                    calcButton.innerHTML = '<i class="fa-solid fa-gears"></i>Calculate REF';
                }
            });
            
            document.getElementById('det-calculate-btn').addEventListener('click', async () => {
                if (!pyodideReady) { showError('det', "Python engine is still initializing. Please wait a moment."); return; }
                
                const matrix = getMatrixValues('det-matrix-container', 'det');
                if (!matrix) return; 

                if (matrix.length === 0 || matrix.some(row => row.length !== matrix.length)) {
                    showError('det', "Determinant can only be calculated for square matrices (NxN).");
                    return;
                }
                
                const calcButton = document.getElementById('det-calculate-btn');
                calcButton.disabled = true;
                calcButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Calculating...';

                try {
                    const det = await pyodide.runPythonAsync(`
                        import numpy as np
                        matrix_py = np.array(${JSON.stringify(matrix)}, dtype=float)
                        if matrix_py.ndim != 2 or matrix_py.shape[0] != matrix_py.shape[1]:
                            raise ValueError("Matrix must be square for determinant calculation.")
                        np.linalg.det(matrix_py)
                    `);
                    
                    const detValue = parseFloat(det.toFixed(6)); 
                    
                    document.getElementById('det-output').textContent = `Determinant = ${detValue.toLocaleString(undefined, {
                        minimumFractionDigits: 0,
                        maximumFractionDigits: 6 
                    })}`;
                    document.getElementById('det-result').classList.remove('hidden');
                    document.getElementById('det-error').style.display = 'none'; 
                } catch (error) {
                    console.error("Error calculating determinant:", error);
                    showError('det', "Calculation error: " + error.message);
                } finally {
                    calcButton.disabled = false;
                    calcButton.innerHTML = '<i class="fa-solid fa-calculator"></i>Calculate Determinant';
                }
            });
        });
    </script>
</body>
</html>